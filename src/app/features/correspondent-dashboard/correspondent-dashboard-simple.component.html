<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">Dashboard do Correspondente</h1>
    <p>Bem-vindo, {{ currentUser?.nomecompleto }}!</p>
  </div>

  <!-- Quick Stats Section -->
  <div class="stats-section" *ngIf="!loading">
    <h2>Resumo das Solicitações</h2>
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon audiencia">
              <mat-icon>campaign</mat-icon>
            </div>
            <div class="stat-details">
              <h3>Audiências</h3>
              <div class="stat-numbers">
                <span class="primary-number">{{ tipoSolicitacaoCounts.audiencia }}</span>
                <span class="secondary-number">solicitações</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon diligencia">
              <mat-icon>work</mat-icon>
            </div>
            <div class="stat-details">
              <h3>Diligências</h3>
              <div class="stat-numbers">
                <span class="primary-number">{{ tipoSolicitacaoCounts.diligencia }}</span>
                <span class="secondary-number">solicitações</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon total">
              <mat-icon>assignment</mat-icon>
            </div>
            <div class="stat-details">
              <h3>Total</h3>
              <div class="stat-numbers">
                <span class="primary-number">{{ getTotalSolicitacoes() }}</span>
                <span class="secondary-number">solicitações</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section" *ngIf="!loading">
    <h2>Minhas Solicitações</h2>
    <div class="charts-grid">
      <!-- Solicitações por Status Chart (Pie Chart) -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Distribuição de Solicitações</mat-card-title>
          <mat-card-subtitle>Proporção das suas solicitações por status</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container horizontal-scroll-container">
            <div class="pie-chart">
              <div class="pie-chart-container">
                <svg viewBox="0 0 100 100" class="pie-svg">
                  <circle cx="50" cy="50" r="40" fill="none" stroke="#eee" stroke-width="20" />
                  <ng-container *ngFor="let value of solicitacoesPorStatusChart.values; let i = index">
                    <circle 
                      *ngIf="value > 0"
                      cx="50" 
                      cy="50" 
                      r="40" 
                      fill="none" 
                      [attr.stroke]="solicitacoesPorStatusChart.colors[i]"
                      stroke-width="20"
                      [attr.stroke-dasharray]="getPieStrokeDasharray(value, solicitacoesPorStatusChart.values)"
                      [attr.stroke-dashoffset]="getPieStrokeDashoffset(i, solicitacoesPorStatusChart.values)"
                      class="pie-segment"
                    />
                  </ng-container>
                </svg>
                <div class="pie-center">
                  <div class="pie-total">{{ getTotalSolicitacoes() }}</div>
                  <div class="pie-label">Total</div>
                </div>
              </div>
              <div class="pie-legend">
                <div 
                  *ngFor="let label of solicitacoesPorStatusChart.labels; let i = index" 
                  class="legend-item"
                >
                  <div 
                    class="legend-color" 
                    [ngStyle]="{'background-color': solicitacoesPorStatusChart.colors[i]}"
                  ></div>
                  <div class="legend-label">{{ label }}: {{ solicitacoesPorStatusChart.values[i] }}</div>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Solicitações por Status Chart (Bar Chart) -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Solicitações por Status</mat-card-title>
          <mat-card-subtitle>Distribuição das suas solicitações por status</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container horizontal-scroll-container">
            <div class="bar-chart responsive-bar-chart">
              <div class="chart-bars">
                <div 
                  *ngFor="let value of solicitacoesPorStatusChart.values; let i = index" 
                  class="bar-container"
                  [attr.data-index]="i"
                  [attr.data-value]="value"
                >
                  <div 
                    class="bar" 
                    [ngStyle]="{
                      'height': getBarHeight(value, getMaxValue(solicitacoesPorStatusChart.values)),
                      'background-color': solicitacoesPorStatusChart.colors[i]
                    }"
                    [attr.data-color]="solicitacoesPorStatusChart.colors[i]"
                    [attr.data-height]="getBarHeight(value, getMaxValue(solicitacoesPorStatusChart.values))"
                  ></div>
                  <div class="bar-label">{{ solicitacoesPorStatusChart.labels[i] }}</div>
                  <div class="bar-value">{{ value }}</div>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Carregando estatísticas...</p>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions" *ngIf="!loading">
    <h2>Ações Rápidas</h2>
    <div class="actions-grid">
      <mat-card class="action-card">
        <mat-card-content>
          <mat-icon>assignment</mat-icon>
          <h3>Minhas Solicitações</h3>
          <p>Visualizar todas as suas solicitações</p>
          <button mat-raised-button color="primary" routerLink="/minhas-solicitacoes">
            Visualizar
          </button>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>